# Game Logic & Rules

## Overview
This is a **scavenger hunt web app** where players (individually or in teams) solve clues that are geographically relevant. The game is designed for inclusivity, with culturally representative avatars and region-specific content.

## Phases
- **Phase 1:**
  - Phase 1 focuses on player individual play. It is designed to bring awareness to the game, esstablish and combat the learning curve for users, and develop a community of players around a common goal that will be needed into the next phases which require Group only participation.
  - Players are assigned to a clue set based on their geolocation.
  - Each clue set covers a specific radius (e.g., 3 miles) and is generated if no existing set exist in the participant‚Äôs location.
  - Players must solve all clues in their assigned clue set to complete stages and levels of Phase 1.
  - If a participant enters a region already covered by a clue set, they are assigned to that set and must solve its clues.
  - No two clue sets can overlap; new sets are generated only for unique, uncovered areas that will not overlap.
- **Phase 2:**  
  - Phase 2 focuses on Group play. Group play purpose is to promote and expand team involvement across larger areas. Groups develop group mechanics, how to coordinate, how to overcome issues within a group. Areas begin to merge to become the best group of their city/province.
  - Begins when all Phase 1 clues are solved, all required scavanger stones are aquired and number of "ready for phase 2" participants (10,000) is reached.
  - Groups will have 10 clues to solve per Hunt
  - Individal participants can still join and get through the stages to advance to Phase 2 to join a group until level 5 is closed.
  - Will introduce new types of challenges, increased difficulty, expanded clue set raduises.
- **Phase 3:**  
  - Phase 3 Continues on Group play. Areas begin to merge to become the best group of their Country.
  - Begins when all Phase 2 stages are completed, all required scavanger stones aquired by total Group (1,000,000 ) is reached.
  - Will introduce new types of challenges, increased difficulty, expanded clue set raduises.
   - Groups will have 20 clues to solve per Hunt
- **Phase 4:**  
  - Phase 4 Continues on Group play. Country vs Country.
  - Begins when all Phase 3 stages are completed, all required scavanger stones aquired by per total Group (5,000,000 ) is reached.
  - Will introduce new types of challenges, increased difficulty, expanded clue set raduises.
   - Groups will have 10 clues to solve per Hunt
   **Phases in general:**  
  - Phases 2, 3, and 4 all hunts are assigned by a group manger to a participant.

## Progression
- Progress is tracked in the `GameProgress` model, which stores the current phase, level, and stage for each game or participant.
- Advancement occurs when all requirements in the current phase are completed, or can be triggered by an admin.
- The backend validates progression and updates the database accordingly.
- The frontend reflects the current progress and restricts access to future phases until requirements are met.

## Clue Sets & Geolocation
- Clue sets are generated dynamically based on first participant to that geolocation.
- If a participant is within the radius of an existing clue set, they are assigned to that set.
- If not, a new clue set is generated for their location, ensuring no overlap with existing sets.
- Example:  
  - If a user is at point 12 (in a 30-mile space) and no clue set exists within 10 miles, a new set is generated from point 7 to 17.
  - If another user is at point 15, they are assigned to the existing set (7‚Äì17).
  - If a user is at point 21, a new set is generated from point 18 to 28, ensuring no overlap with the previous set.

## Clue Generation
- Clues are generated by the AI based on a clueset's geolocation and the context of the clue set.
- Clues are unique to each clue set and are reused for participants assigned to the same set.
- **Radius standards**
- new clues are generated every stage and assigned to all clueSets/Hunts
- Level 1 - 2: 2 mile radius
- Level 3: participant are not restricted to their clueSet. They will have access to their North, East, South and West most nearest clue set.
- Level 3: participant are not restricted to their clueSet. They will have access to their North, East, South and West most nearest clue set.
- Level 4 - 5: 5 mile radius. Group formation. New clueSets are generated for Groups. Lower level cluesets can not be accessed by groups
- Level 6: Groups are not restricted to their clueSet.. New clueSets are generated for Groups.
- Level 7-8: state wide radius. All clues are timed.
- Level 9: All cluseSets nation wide are available.
- Level 10 - 11: Country wide radius. Clues are timed and difficult.
- Level 11: Top 2 countries group will travel to another country to compete in a timed experience to solve a hunt in the selected country. The radius is that selected country within a selected state/province.

## How to solve clues
- Some clues requires providing an answer via text input
- Some clues requires providing an answer via photo upload
- Some clues requires providing an answer via photo upload and text input
- Some clues are timed.
- The prompt to the AI will determine the requirements.

## Badges
- Badges are earned when stages are completeted.
- Badges can be merged to create a Level Badge
- 3 Level badges can be merged to create a Master badge

## Particpant Progression Requirements
stones are total not additional
- **Level 1**
- **Level 1 Stage 1:**  
-      1000 stones
- **Level 1 Stage 2:**  
-      2000 stones
-      Stage 1 Badge
- **Level 1 Stage 3:**  
-      3000 stones
-      Stage 2 Badge
- **Level 1 Stage 4:**  
-      4000 stones
-      Stage 3 Badge

- **Level 2**
- **Level 2 Stage 1:**  
-      Level 1 stage 4 badge
-      5000 stones
- **Level 2 Stage 2:**  
-      6000 stones
-      Stage 1 Badge
- **Level 2 Stage 3:**  
-      7000 stones
-      Stage 2 Badge
- **Level 2 Stage 4:**  
-      8000 stones
-      Stage 3 Badge

- **Level 3**
- **Level 3 Stage 1:**  
-      Level 2 stage 4 badge
-      10000 stones
- **Level 3 Stage 2:**  
-      12000 stones
-      Stage 1 Badge
- **Level 3 Stage 3:**  
-      13000 stones
-      Stage 2 Badge
- **Level 3 Stage 4:**  
-      14000 stones
-      Stage 3 Badge

- **Level 4**
-      Minimum 2 Group members
- **Level 4 Stage 1:**  
-      30000 Group total stones
-      Level 3 stage 4 badge
- **Level 4 Stage 2:**
-      45000 Group total stones
-      Stage 2 Badge
- **Level 4 Stage 3:**  
-      60000 Group total stones
-      Stage 2 Badge
- **Level 4 Stage 4:**  
-      75000 Group total stones
-      Stage 3 Badge

- **Level 5**
-      Minimum 5 Group members
- **Level 5 Stage 1:**  
-      150,000 Group total stones
-      Level 4 stage 4 badge
- **Level 5 Stage 2:**
-      250000 Group total stones
-      Stage 2 Badge
- **Level 5 Stage 3:**  
-      350000 Group total stones
-      Stage 2 Badge
- **Level 5 Stage 4:**  
-      450000 Group total stones
-      Stage 3 Badge

- **Level 6**
-      Minimum 10 Group members
- **Level 6 Stage 1:**  
-      500000 Group total stones
-      Level 5 stage 4 badge
- **Level 6 Stage 2:**
-      62500 Group total stones
-      Stage 2 Badge
- **Level 6 Stage 3:**  
-      75000 Group total stones
-      Stage 2 Badge
- **Level 6 Stage 4:**  
-      87500 Group total stones
-      Stage 3 Badge

- **Level 7**
-      Minimum 25 Group members
- **Level 7 Stage 1:**  
-      1250000 Group total stones
-      Level 6 stage 4 badge
- **Level 7 Stage 2:**
-      150000 Group total stones
-      Stage 2 Badge
- **Level 7 Stage 3:**  
-      175000 Group total stones
-      Stage 2 Badge
- **Level 7 Stage 4:**  
-      200000 Group total stones
-      Stage 3 Badge

- **Level 8**
-      Minimum 50 Group members
- **Level 8 Stage 1:**  
-      2500000 Group total stones
-      Level 7 stage 4 badge
- **Level 8 Stage 2:**
-      275000 Group total stones
-      Stage 2 Badge
- **Level 8 Stage 3:**  
-      325000 Group total stones
-      Stage 2 Badge
- **Level 8 Stage 4:**  
-      350000 Group total stones
-      Stage 3 Badge

- **Level 9**
-      Minimum 75 Group members
- **Level 9 Stage 1:**  
-      3750000 Group total stones
-      Level 8 stage 4 badge
- **Level 9 Stage 2:**
-      400000 Group total stones
-      Stage 2 Badge
- **Level 9 Stage 3:**  
-      425000 Group total stones
-      Stage 2 Badge
- **Level 9 Stage 4:**  
-      450000 Group total stones
-      Stage 3 Badge

- **Level 10**
-      Minimum 100 Group members
- **Level 10 Stage 1:**  
-      5000000 Group total stones
-      Level 9 stage 4 badge
- **Level 10 Stage 2:**
-      5000000 Group total stones
-      Stage 2 Badge
- **Level 10 Stage 3:**  
-      5000000 Group total stones
-      Stage 2 Badge
- **Level 10 Stage 4:**  
-      5000000 Group total stones
-      Stage 3 Badge

## Group Forming
- **Group forming requirement**
- Every level has 4 stages.
- Every stage completed earns a badge.
- 4 badges earned in a level can be merged for a Platinum Badge.
- It take 3 Platinum badges to merge to a Manager Badge
- Only participants with a Manager badge can form a group.
- **How to loose badges**
- If a user can not solve a clue they can trade in their badge (in that level) as a substitute for the answer.
- Every stage completed earns a badge.
- It takes all 4 badges of tat level to merge for the platinum badge, if a user do not have a 4 badges they can not merge the stage badges to the platinum badge. It also takes all 3 platinum badges in level 1,2,and 3 to merge for the Manager badge.

## Group Abilitis
- **Vote of no Contest**
- The group can force a vote to remove the group mananager and replace the position with another participant within the group, who posesses a Manager's Badge. A "Vote of No Contest" will always be present on a participants "Group" page. If there a participant within a group clicks on this button this will trigger a voting poll to remove the group manager. Particpants of the group have 24 hours to respond to the poll. Each vote in favor of removal must also accompany a selection for replacement (presented in a dropdown selection). If a replacement is not available the "vote of no confidence" button will not be available.
Majority of the group must vote for results to be accepted.
- **Group voting**
- A group manager may want to engage with the group with decision making. A manager can inact a voting poll. Each member of the group can cast a vote when a poll is inacted.
- **Group Manager rights**
- Can initiate a voting poll.
- Can assign a group members to solve a hunt.
- Can remove group member.
- Can invite a particpant to a group.

## Error Handling
- All errors are handled using centralized error configuration in `src/lib/apiErrorHandling.ts`.
- Robust error handling is enforced throughout the backend and frontend.

## Technology & Architecture
- Uses **Next.js App Router** with server and client components.
- Written in **TypeScript** with strict typings (no `any` types).
- Styled with **Tailwind CSS**.
- Data managed with **Prisma** ORM.
- Environment variables are validated and securely managed.

## Additional Rules & Guidelines
- Unused files, variables, and duplicate functions are deleted for code quality.
- All functions are typed, and unused imports are avoided.
- Inclusive design and culturally representative avatars are prioritized.
- Admins have the ability to manually advance game progress or ban a participant

## Administrative
- **Admin panel**
- The purpose of the admin panel is to give admins the operational power to create experiences and handle any issses within the app and game.
- Everything that happens on the app **must have a record to be viewed**
- Every api, data, ui and state error **must be recorded**
- Every creation, deletion  and update **must be recorded**
- Every login success failure and warning, registration success failure and warning, logout success failure and warning **must be recorded**
- Every user that changes their settings **must be recorded**
- Every user restriction **must be recorded**
- Every creation deletion and update of a game **must be recorded**
- Every new clue set **must be recorded**
- Every new Hunt **must be recorded**
- Every connection to a wallet **must be recorded**
- Every addition or removal of scavanger stones **must be recorded**
- Every time a pariicipant starts and solves clue **must be recorded**
- Every time a poll is initiated **must be recorded**
- Every time a vote is cast **must be recorded**
- **Admin rights**
  - Admins can manually advance game progress for any participant, group, or game phase.
  - Admins can not assign or reassign participants to clue sets or groups.
  - A Super Admin can create, edit, or delete games, clue sets, and hunts.
  - Admins can ban, restrict, or reinstate participants.
  - A Super Admin can view and export all logs and records for auditing.
  - Admins can not initiate or close polls and group votes.
  - Admins can not add or remove scavenger stones from any participant or group.
  - Admins can reset or override badges, group status, or progression for troubleshooting.
  - Admins can impersonate a user (view the app as a specific participant for support/debugging).
  - Admins can manage wallet connections and review wallet-related actions.
  - Admins can trigger system-wide announcements or notifications.
  - Admins can review and resolve reported issues, errors, or disputes.

## Pages needed
- In addition to what is already created.
- Home/Landing Page
- Registration Page
- Login Page
- Error 404 page
- Available Games Page
- User Dashboard page
- User setting page
- Community Bulletin Board Page
- Admin Panel Page
- Admin Game Details Data Page
- Groups Available page (for participantsin looking to join a group)
- Group page (for participantsin a group)
- Game Creation/Edit Page (for admins to create or modify games)
- Clue Set Management Page (for admins to view, create, or edit clue sets)
- Hunt Management Page (for admins to view, create, or edit hunts)
- Badge & Progression Audit Page (for admins to review badge merges, losses, and progression history)
- Polls & Voting Management Page (for admins to monitor and manage group polls/votes)
- Error & Activity Log Page (for admins to view all system and user activity logs)
- Wallet Management Page (for admins to view and manage wallet connections and actions)


## AI Prompt and Rules
Generate a scavenger hunt clue set based on the following parameters:

---

üî¢ **Clue Count**
- A variable `clueCount` will be passed to specify how many clues should be generated.
- AI must generate exactly the number of clues specified.

---

üéØ **Difficulty Levels** (passed as variable: `difficultyLevel`)
- **Level 1**
  - Clues must be simple, direct, and minimally abstract.
  - All clues must require `text` answers only.
- **Level 2**
  - Clues should include moderate abstraction and metaphor.
  - Mix of `text` and `image` answers allowed.
- **Level 3**
  - Clues should be deeply cryptic and multi-layered.
  - Mix of `text`, `image`, or `both` answers allowed.
- **Level 4**
  - AI must not generate clues.
  - Return an empty clue array with a note:  
    ‚ÄúLevel 4 difficulty requires admin-created clues. All participant responses must include image uploads or both text and image.‚Äù

---

 **Sponsor Focus** (passed as object: `sponsorFocus: { location, focusLevel }`)
- **Level 1 Focus**: Mention foot traffic or proximity to the sponsor location.
- **Level 2 Focus**: Include a clue that requires a selfie in front of the sponsor.
- **Level 3 Focus**: Include a clue that requires interaction with sponsor staff (e.g. retrieve an object or answer).
- **Level 4 Focus**: Entire clue set is about the sponsor ‚Äî AI must not generate; Admin will provide.

---

üåç **Community Cause Focus**
- If the hunt is tied to a community cause (e.g. environmental cleanup, health awareness), AI must not generate clues.
- These clue sets will be personalized and created by Admin in collaboration with local officials.

---

üö´ **Main Objective Logic** (passed as array: `mainObjectives`)
- AI must not reuse any location already listed in `mainObjectives` as a primary focus.
- AI may reference previously used main objectives only as supporting links if contextually relevant to a new subject or location.
- If AI selects a new main objective for the current clue set, it must include that value in the response as `mainObjective` so it can be stored in the app database.

---

üß© **Clue Formatting Rules**
- Each clue should be cryptic, layered, and immersive ‚Äî using poetic or riddle-like phrasing.
- Clues must progress logically: each clue‚Äôs answer leads to the next clue‚Äôs context.
- Avoid naming the final location directly until the last clue.
- Use indirect associations to build tension and mystery.
- End clues with ‚ÄúWhat am I?‚Äù if the clue is conceptual or metaphorical (not referencing a specific place).
- Do not use ‚ÄúWhat am I?‚Äù if the clue leads to a specific location or object.

---

üì¶ **Response Format**
Return a structured JSON object with:
- `difficultyLevel`
- `mainObjective`: the primary location or subject the clue set is built around
- `finalLocation` (if applicable)
- `clues`: an array of clue objects, each containing:
  - `clueNumber`
  - `clueText`
  - `answerType`: `"text"`, `"image"`, or `"both"`
  - `expectedAnswer`: a short description or label for validation

---

 **Timed Experience**
 Some Clues will be timed and have an expiration on when they have to b solved.

---

üé≠ **Tone & Solvability**
- The tone should be clever, mysterious, fun and immersive ‚Äî suitable for a digital scavenger hunt experience.
- Clues should be solvable through online research, local exploration, or interaction with the environment.
